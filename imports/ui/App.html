<body>
    {{> mainContainer}}
</body>


<template name="mainContainer">
    {{#if notReady}} 
    Kobolds gathering...
    {{else}}
    <div class="container">
        <header>
            <h1>{{townName}}</h1>
        </header>
        Resources
        <ul>
            {{#each resource in resources}}
            {{> showResource resource}}
            {{/each}}
        </ul>


        Kobolds
        <ul>
            {{#each kobold in kobolds}}
            {{> showKobold kobold}}
            {{/each}}
        </ul>

        Jobs
        <ul>
            {{#each job in jobs}}
            {{> showJob job}}
            {{/each}}
        </ul>

        Expeditions
        <ul>
            {{#each expo in expos}}
            {{> showExpo expo}}
            {{/each}}
        </ul>

        Noticeboard
        <br>
        {{> noticeboard}}
    </div>
    {{/if}}
</template>

<template name="showKobold">
    <div class="clickable js-click-name kobold-name" style="color:{{textColor}}; background-color:{{color}};">
        {{name}}
    </div>

    {{#if showDetails}}
<div class="details" style="border-color: {{color}};">
    Color: {{color}}
    <br>
    Physical: {{physical}}
    <br>
    Mental: {{mental}}
    <br>
    Social: {{social}}
    <br>
    Current job: {{#if job}}{{job}}{{else}}None{{/if}}
    {{#if job}}
        <button class="js-quit-job">Quit job</button>
    {{/if}}
    <br>
    <select style="background-color: {{breedTarget.color}}; color: {{breedTarget.textColor}};" class="js-breed-select" id="breedSelect">
        <option selected style="background-color: white; color: black;">Breed With</option>
        {{#each otherKobold in kobolds}}
            {{#unless isCurrentKobold otherKobold._id}}
                {{#unless otherKobold.busy}}
                    <option style="background-color: {{otherKobold.color}}; color: {{otherKobold.textColor}}" value="{{otherKobold._id}}">{{otherKobold.name}}</option>
                {{/unless}}
            {{/unless}}
        {{/each}}
    </select>
    <button disabled={{isBusy}} class="js-breed">Confirm</button>
    
    <br>

    <select class="js-select-job" style="color: {{selectedJob.color}};" id="jobSelect">
        <option selected style="color: black; background-color: white;">Chose job</option>
        {{#each job in jobs}}
            <option style="color: {{job.color}};" value="{{job.name}}">{{job.name}}</option>
        {{/each}}
    </select>
    <button disabled={{isBusy}} class="js-chose-job">Confirm</button>
</div>
    {{/if}}
    
    <br>
</template>

<template name="showResource">
    {{#if visible}}
        <div class="clickable js-click-name" style="color: {{color}};">
            {{name}}: {{stockpile}}
        </div>
        {{#if showDetails}}
            <div class="details" style="border-color: {{color}};">
                Stockpile: {{stockpile}}
            </div>
        {{/if}}
    {{/if}}

    <br>
</template>

<template name="showJob">
    <div class="clickable js-click-name" style="color: {{color}};">
        {{name}}
    </div>

    {{#if showDetails}}
        <div class="details" style="border-color: {{color}};">
            Produces:
            <br>
            <ul>
                {{#each resource in resources}}
                <li>{{resourceProduction resource}}&nbsp;{{resource}}</li>
                {{/each}}
            </ul>
            Currently working this job:
            <ul>
                {{#each kobold in koboldsAtJob}}
                    <li class="kobold-list" style="color: {{kobold.textColor}}; background-color: {{kobold.color}}">{{kobold.name}}</li>
                    <br>
                {{/each}}
            </ul>
            <br>
        </div>
    {{/if}}
</template>

<template name="showExpo">
    <div class="clickable js-click-name" style="color: {{color}};">
        {{name}}
    </div>
    {{#if showDetails}}
<div class="details" style="border-color: {{color}};">
    Your kobolds are looking for:
    <br>
    <ul>
        {{#each resource in resources}}
            <li>{{resource}}</li>
        {{/each}}
    </ul>
    {{#each slot in slots}}
        <select style="color: {{slot.textColor}}; background-color: {{ slot.color }};" class="js-party-select js-party-select-{{name}}" data-index="{{@index}}">
            <option selected style="color: {{slot.textColor}}; background-color:{{slot.color}};">{{slot.name}}</option>
            {{#each kobold in availableKobolds}}
                <option style="background-color: {{ kobold.color }}; color:{{kobold.textColor}};" value="{{kobold._id}}">
                    {{kobold.name}}
                </option>
            {{/each}}
        </select>
        <br>
    {{/each}}
    <button class="js-launch-expo" disabled={{expoNotFilled}}>Launch expedition</button>

    <br>
</div>
    {{/if}}
</template>

<template name="noticeboard">
    <div class="noticeboard">
        {{#each notice in notices}}
            {{notice.text}}
            <p class="clickable js-dismiss noticeboard-dismiss" data-notice="{{notice.id}}">X</p>
            <br>
        {{/each}}
    </div>
</template>